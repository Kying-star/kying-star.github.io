<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Monorepo | kying-star的博客</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
    <meta name="description" content="记录学习">
    <link rel="preload" href="/assets/css/0.styles.da21fd89.css" as="style"><link rel="preload" href="/assets/js/app.6cee7c1e.js" as="script"><link rel="preload" href="/assets/js/3.93150daa.js" as="script"><link rel="preload" href="/assets/js/1.98eba2ee.js" as="script"><link rel="preload" href="/assets/js/78.f4a46975.js" as="script"><link rel="prefetch" href="/assets/js/10.41c0ceac.js"><link rel="prefetch" href="/assets/js/100.075a06d0.js"><link rel="prefetch" href="/assets/js/101.9941300a.js"><link rel="prefetch" href="/assets/js/102.ae023a6f.js"><link rel="prefetch" href="/assets/js/103.19072949.js"><link rel="prefetch" href="/assets/js/104.7e923608.js"><link rel="prefetch" href="/assets/js/105.3d90b7dd.js"><link rel="prefetch" href="/assets/js/106.4f7b1d02.js"><link rel="prefetch" href="/assets/js/107.27b21ad0.js"><link rel="prefetch" href="/assets/js/108.5bf76e8c.js"><link rel="prefetch" href="/assets/js/109.480fc602.js"><link rel="prefetch" href="/assets/js/11.e6199fab.js"><link rel="prefetch" href="/assets/js/110.8b794b16.js"><link rel="prefetch" href="/assets/js/111.52ebbf05.js"><link rel="prefetch" href="/assets/js/112.4b799551.js"><link rel="prefetch" href="/assets/js/113.7080542e.js"><link rel="prefetch" href="/assets/js/114.4ab78ac0.js"><link rel="prefetch" href="/assets/js/115.53410cca.js"><link rel="prefetch" href="/assets/js/116.2304a335.js"><link rel="prefetch" href="/assets/js/117.24dc7fe2.js"><link rel="prefetch" href="/assets/js/118.c7d740a7.js"><link rel="prefetch" href="/assets/js/119.b653c130.js"><link rel="prefetch" href="/assets/js/12.efc3bb41.js"><link rel="prefetch" href="/assets/js/120.b5f5d7e7.js"><link rel="prefetch" href="/assets/js/121.7438e765.js"><link rel="prefetch" href="/assets/js/122.6cb768a5.js"><link rel="prefetch" href="/assets/js/123.a7fe1c20.js"><link rel="prefetch" href="/assets/js/124.c819a4c8.js"><link rel="prefetch" href="/assets/js/125.b0fd2638.js"><link rel="prefetch" href="/assets/js/126.730734d7.js"><link rel="prefetch" href="/assets/js/127.2a0cc89c.js"><link rel="prefetch" href="/assets/js/128.6340db03.js"><link rel="prefetch" href="/assets/js/129.2eccd5d5.js"><link rel="prefetch" href="/assets/js/13.558432a7.js"><link rel="prefetch" href="/assets/js/130.62dc12c6.js"><link rel="prefetch" href="/assets/js/131.020c190f.js"><link rel="prefetch" href="/assets/js/132.6f82e5b8.js"><link rel="prefetch" href="/assets/js/133.57f024cd.js"><link rel="prefetch" href="/assets/js/134.24cc80c3.js"><link rel="prefetch" href="/assets/js/135.b9f25927.js"><link rel="prefetch" href="/assets/js/136.27e5345d.js"><link rel="prefetch" href="/assets/js/137.d9e48291.js"><link rel="prefetch" href="/assets/js/138.28ab225d.js"><link rel="prefetch" href="/assets/js/139.3ec341fe.js"><link rel="prefetch" href="/assets/js/14.a4ec56af.js"><link rel="prefetch" href="/assets/js/140.7a94729d.js"><link rel="prefetch" href="/assets/js/141.9b4cdb6e.js"><link rel="prefetch" href="/assets/js/142.ee5bab24.js"><link rel="prefetch" href="/assets/js/143.5ee0c3f0.js"><link rel="prefetch" href="/assets/js/144.137c1bd1.js"><link rel="prefetch" href="/assets/js/145.32fb65ab.js"><link rel="prefetch" href="/assets/js/146.58e3bc5e.js"><link rel="prefetch" href="/assets/js/147.aa406ffd.js"><link rel="prefetch" href="/assets/js/148.46a1d765.js"><link rel="prefetch" href="/assets/js/149.81309e88.js"><link rel="prefetch" href="/assets/js/15.fc67127a.js"><link rel="prefetch" href="/assets/js/150.a3ff86ca.js"><link rel="prefetch" href="/assets/js/151.77f5635e.js"><link rel="prefetch" href="/assets/js/152.781ffd78.js"><link rel="prefetch" href="/assets/js/153.d1c48997.js"><link rel="prefetch" href="/assets/js/154.dfe345e5.js"><link rel="prefetch" href="/assets/js/155.9ce0efc6.js"><link rel="prefetch" href="/assets/js/156.dd593042.js"><link rel="prefetch" href="/assets/js/157.d08fa852.js"><link rel="prefetch" href="/assets/js/158.d80a6434.js"><link rel="prefetch" href="/assets/js/159.f6235582.js"><link rel="prefetch" href="/assets/js/16.ad084e9f.js"><link rel="prefetch" href="/assets/js/160.a0a020b2.js"><link rel="prefetch" href="/assets/js/161.b27a9a45.js"><link rel="prefetch" href="/assets/js/162.79eacd26.js"><link rel="prefetch" href="/assets/js/17.9d4df9ca.js"><link rel="prefetch" href="/assets/js/18.68c426a7.js"><link rel="prefetch" href="/assets/js/19.4cd4c411.js"><link rel="prefetch" href="/assets/js/20.932d3a29.js"><link rel="prefetch" href="/assets/js/21.af13e11a.js"><link rel="prefetch" href="/assets/js/22.e32047b0.js"><link rel="prefetch" href="/assets/js/23.0adb426c.js"><link rel="prefetch" href="/assets/js/24.0ea840b7.js"><link rel="prefetch" href="/assets/js/25.d9e6fdc9.js"><link rel="prefetch" href="/assets/js/26.58a6462c.js"><link rel="prefetch" href="/assets/js/27.b698a918.js"><link rel="prefetch" href="/assets/js/28.4b04cafc.js"><link rel="prefetch" href="/assets/js/29.8374667d.js"><link rel="prefetch" href="/assets/js/30.32923873.js"><link rel="prefetch" href="/assets/js/31.c10f1448.js"><link rel="prefetch" href="/assets/js/32.55634d10.js"><link rel="prefetch" href="/assets/js/33.61ab77ae.js"><link rel="prefetch" href="/assets/js/34.871c9cb8.js"><link rel="prefetch" href="/assets/js/35.d8046fcb.js"><link rel="prefetch" href="/assets/js/36.f9006631.js"><link rel="prefetch" href="/assets/js/37.774f1fe1.js"><link rel="prefetch" href="/assets/js/38.ab3d407a.js"><link rel="prefetch" href="/assets/js/39.45af4424.js"><link rel="prefetch" href="/assets/js/4.d9438b6c.js"><link rel="prefetch" href="/assets/js/40.29b96586.js"><link rel="prefetch" href="/assets/js/41.df498fde.js"><link rel="prefetch" href="/assets/js/42.b071138d.js"><link rel="prefetch" href="/assets/js/43.31aefea2.js"><link rel="prefetch" href="/assets/js/44.0a3aaa49.js"><link rel="prefetch" href="/assets/js/45.9a800d1d.js"><link rel="prefetch" href="/assets/js/46.9264ceec.js"><link rel="prefetch" href="/assets/js/47.c62df241.js"><link rel="prefetch" href="/assets/js/48.dbcb8854.js"><link rel="prefetch" href="/assets/js/49.bfae089b.js"><link rel="prefetch" href="/assets/js/5.6c4aa1d6.js"><link rel="prefetch" href="/assets/js/50.61c2a6b4.js"><link rel="prefetch" href="/assets/js/51.c44ff681.js"><link rel="prefetch" href="/assets/js/52.c7bd885e.js"><link rel="prefetch" href="/assets/js/53.49121fdb.js"><link rel="prefetch" href="/assets/js/54.2513e410.js"><link rel="prefetch" href="/assets/js/55.d3702d52.js"><link rel="prefetch" href="/assets/js/56.51afdc00.js"><link rel="prefetch" href="/assets/js/57.34440700.js"><link rel="prefetch" href="/assets/js/58.a0aa3090.js"><link rel="prefetch" href="/assets/js/59.5f84cf01.js"><link rel="prefetch" href="/assets/js/6.ebe2144f.js"><link rel="prefetch" href="/assets/js/60.39a92d92.js"><link rel="prefetch" href="/assets/js/61.fa36b7d1.js"><link rel="prefetch" href="/assets/js/62.04f978c7.js"><link rel="prefetch" href="/assets/js/63.1f0edaf5.js"><link rel="prefetch" href="/assets/js/64.c34cbf5c.js"><link rel="prefetch" href="/assets/js/65.81a63513.js"><link rel="prefetch" href="/assets/js/66.965acdc1.js"><link rel="prefetch" href="/assets/js/67.942cda66.js"><link rel="prefetch" href="/assets/js/68.c676cedc.js"><link rel="prefetch" href="/assets/js/69.621c037a.js"><link rel="prefetch" href="/assets/js/7.bf6c0403.js"><link rel="prefetch" href="/assets/js/70.bb98bd8f.js"><link rel="prefetch" href="/assets/js/71.b9172b03.js"><link rel="prefetch" href="/assets/js/72.ee686309.js"><link rel="prefetch" href="/assets/js/73.98ee5e7e.js"><link rel="prefetch" href="/assets/js/74.2b89ed58.js"><link rel="prefetch" href="/assets/js/75.b36f2fa7.js"><link rel="prefetch" href="/assets/js/76.f6fa47db.js"><link rel="prefetch" href="/assets/js/77.e82c25ce.js"><link rel="prefetch" href="/assets/js/79.9a429893.js"><link rel="prefetch" href="/assets/js/8.e9d40c4d.js"><link rel="prefetch" href="/assets/js/80.121ac946.js"><link rel="prefetch" href="/assets/js/81.adef8077.js"><link rel="prefetch" href="/assets/js/82.092ce56d.js"><link rel="prefetch" href="/assets/js/83.d1cc3982.js"><link rel="prefetch" href="/assets/js/84.e42f6953.js"><link rel="prefetch" href="/assets/js/85.ffaf0a7a.js"><link rel="prefetch" href="/assets/js/86.23d87153.js"><link rel="prefetch" href="/assets/js/87.27ff81ca.js"><link rel="prefetch" href="/assets/js/88.6983b303.js"><link rel="prefetch" href="/assets/js/89.3ba5812a.js"><link rel="prefetch" href="/assets/js/9.a882d041.js"><link rel="prefetch" href="/assets/js/90.c7397f47.js"><link rel="prefetch" href="/assets/js/91.3acbb274.js"><link rel="prefetch" href="/assets/js/92.d15a33c4.js"><link rel="prefetch" href="/assets/js/93.c6a5693f.js"><link rel="prefetch" href="/assets/js/94.3ad9743a.js"><link rel="prefetch" href="/assets/js/95.80814144.js"><link rel="prefetch" href="/assets/js/96.239aca80.js"><link rel="prefetch" href="/assets/js/97.b96a5c15.js"><link rel="prefetch" href="/assets/js/98.9148f62d.js"><link rel="prefetch" href="/assets/js/99.9264eb9c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.da21fd89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>kying-star的博客</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>kying-star的博客</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">kying-star的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont undefined"></i>
  指北
</a></div><div class="nav-item"><a href="/language/" class="nav-link"><i class="iconfont undefined"></i>
  语言学习
</a></div><div class="nav-item"><a href="/code/AI/" class="nav-link"><i class="iconfont undefined"></i>
  AI
</a></div><div class="nav-item"><a href="/code/webfont/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  前端
</a></div><div class="nav-item"><a href="/code/backend/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></div><div class="nav-item"><a href="/code/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="iconfont undefined"></i>
  杂项
</a></div><div class="nav-item"><a href="https://github.com/Kying-star" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><!----> <h3 class="name" data-v-ca798c94>
    kying-star的博客
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>8</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont undefined"></i>
  指北
</a></div><div class="nav-item"><a href="/language/" class="nav-link"><i class="iconfont undefined"></i>
  语言学习
</a></div><div class="nav-item"><a href="/code/AI/" class="nav-link"><i class="iconfont undefined"></i>
  AI
</a></div><div class="nav-item"><a href="/code/webfont/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  前端
</a></div><div class="nav-item"><a href="/code/backend/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></div><div class="nav-item"><a href="/code/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="iconfont undefined"></i>
  杂项
</a></div><div class="nav-item"><a href="https://github.com/Kying-star" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/js/" class="sidebar-heading clickable"><span>js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/css/" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/code/webfont/ts/" class="sidebar-heading clickable"><span>typescript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/react/" class="sidebar-heading clickable"><span>React</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/Frontier/" class="sidebar-heading clickable router-link-active open"><span>前端新技术</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/code/webfont/Frontier/monorepo.html" aria-current="page" class="active sidebar-link">Monorepo</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/regex/" class="sidebar-heading clickable"><span>正则表达式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/code/webfont/Browser/" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>kying-star的博客</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-2d5f533b><main class="page" style="padding-right:0;"><div class="page-title" style="display:none;"><h1 class="title">Monorepo</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>kying-star的博客</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="monorepo"><a href="#monorepo" class="header-anchor">#</a> Monorepo</h1> <h4 id="monorepo-一种项目管理方案-多个项目放在同一个文件夹下面"><a href="#monorepo-一种项目管理方案-多个项目放在同一个文件夹下面" class="header-anchor">#</a> Monorepo (一种项目管理方案:多个项目放在同一个文件夹下面)</h4> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75a56317bdf94794a8b29f6cd184c888~tplv-k3u1fbpfcp-watermark.awebp" style="zoom:50%;"> <h5 id="multi-repository-将项目分文件夹管理-的缺点"><a href="#multi-repository-将项目分文件夹管理-的缺点" class="header-anchor">#</a> Multi Repository(将项目分文件夹管理)的缺点:</h5> <p>1、代码难以复用  - 获取某一个工具库需要下载那个依赖的包，但如果依赖的代码出错，就需要修改依赖源头的代码，然后在上传到npm上，然后再在本项目重新拉取那个包的依赖。这样的流程过于麻烦了。</p> <p>2、版本的管理 : 依赖的升级困难，如果多个项目都需要使用某一个包，这个包的依赖版本升级时，所有依赖于这个包的项目都需要做对应的更新。</p> <p>3、项目的基建 : 组织下的多个项目无法做归一化的流程管理，会加大项目管理的复杂度，难以维护。</p> <h2 id="monorepo-的好处"><a href="#monorepo-的好处" class="header-anchor">#</a> Monorepo 的好处:</h2> <h3 id="工作流的一致性"><a href="#工作流的一致性" class="header-anchor">#</a> 工作流的一致性</h3> <p>所有的项目放在一个仓库当中，复用起来非常方便，如果有依赖的代码变动，那么用到这个依赖的项目当中会立马感知到。并且所有的项目都是使用最新的代码，不会产生其它项目版本更新不及时的情况。</p> <h3 id="项目基建成本的降低"><a href="#项目基建成本的降低" class="header-anchor">#</a> 项目基建成本的降低</h3> <p>所有项目复用一套标准的工具和规范，无需切换开发环境，如果有新的项目接入，也可以直接复用已有的基建流程，比如 CI 流程、构建和发布流程。这样只需要很少的人来维护所有项目的基建，维护成本也大大减低。</p> <h3 id="团队协作也更加容易"><a href="#团队协作也更加容易" class="header-anchor">#</a> 团队协作也更加容易</h3> <p>大家都在一个仓库开发，能够方便地共享和复用代码，方便检索项目源码，另一方面，git commit 的历史记录也支持以功能为单位进行提交，之前对于某个功能的提交，需要改好几个仓库，提交多个 commit，现在只需要提交一次，简化了 commit 记录，方便协作。</p> <h2 id="monorepo-的缺点"><a href="#monorepo-的缺点" class="header-anchor">#</a> monorepo 的缺点</h2> <h3 id="多个子仓库之间的依赖冲突"><a href="#多个子仓库之间的依赖冲突" class="header-anchor">#</a> 多个子仓库之间的依赖冲突</h3> <p>各个包之间都存在各自的依赖，有些依赖可能是多个包都需要的，我们肯定是希望相同的依赖能提升到 root 目录下安装，其它的依赖装哪都行。</p> <p>此时我们可以通过 yarn 来解决问题（npm 7 之前不行），需要在 package.json 中加上 workspaces 字段表明多包目录，通常为 packages。</p> <p>之后当我们安装依赖的时候，yarn 会尽量把依赖拍平装在根目录下，存在版本不同情况的时候会把使用最多的版本安装在根目录下，其它的就装在各自目录里。</p> <p>这种看似正确的做法，可能又会带来更恶心的问题。</p> <p>比如说多个 package 都依赖了 React，但是它们版本并不都相同。此时 node_modules 里可能就会存在这种情况：根目录下存在这个 React 的一个版本，包的目录中又存在另一个依赖的版本。</p> <p>因为 node 寻找包的时候都是从最近目录开始寻找的，此时在开发的过程中可能就会出现多个 React 实例的问题，熟悉 React 开发的读者肯定知道这就会报错了。</p> <p>遇到这种情况的时候，我们就得用 resolutions 去解决问题，当然也可以通过阻止 yarn 提升共同依赖来解决（更麻烦了）。笔者已经不止一次遇到过这种问题，多是安装依赖的依赖造成的多版本问题。</p> <h3 id="link"><a href="#link" class="header-anchor">#</a> link</h3> <p>在 multi repo 中各种 link 已经够头疼了，我可不想在 mono repo 中继续 link 了。</p> <p>此时 yarn 又拯救了我们，在安装依赖的时候会帮助我们将各个 package 软链到根目录中，这样每个 package 就能找到另外的 package 以及依赖了。</p> <p>但是实际上这样的方式还会带来一个坑。因为各个 package 都能访问到拍平在根目录中的依赖了，因此此时其实我们无需在 package.json 中声明 dependencies 就能使用别人的依赖了。这种情况很可能会造成我们最终忘了加上 dependencies，一旦部署上线项目就运行不起来了。</p> <p>以上两块主要聊了依赖以及 link 层面的问题，这部分我们可以直接通过 yarn 解决，虽然又引入了别的问题。</p> <h3 id="构建"><a href="#构建" class="header-anchor">#</a> 构建</h3> <p>构建是我们会遇到的第一个问题。这时候可能有些读者就会说了，构建不就是跑个 build 么，能有个啥问题。哎，接下来我就跟你聊聊这些问题。</p> <p>首先因为所有包都存在一个仓库中了，如果每次执行 CI 的时候把所有包都构建一遍，那么一旦代码量变多，每次构建可能都要花上不少的时间。</p> <p>这时候肯定有读者会想到增量构建，每次只构建修改了代码的 package，这个确实能够解决问题，核心代码也很简单：</p> <div class="language- extra-class"><pre class="language-text"><code>git diff --name-only {git tag / commit sha} --{package path}
</code></pre></div><p>上述命令的功能是寻找从上次的 git tag 或者初次的 commit 信息中查找某个包是否存在文件变更，然后我们拿到这些信息只针对变更的包做构建就行。但是注意这个命令的前提是在部署的时候打上 tag，否则就找不到上次部署的节点了。</p> <p>但是单纯这样的做法是不够的，因为在 mono repo 中我们还会遇到多个 package 之间有依赖的场景</p> <p>在这种情况下假如此时在 CI 中发现只有 A 包需要构建并且只去构建了 A 包，那么就会出现问题：在 TS 环境下肯定会报错找不到 D 包的类型。</p> <p>在这种存在包于包之间有依赖的场景时，我们需要去构建一个有向无环图（DAG）来进行拓扑排序，关于这个概念有兴趣的读者可以自行查阅资料。</p> <p>总之在这种场景下，我们需要寻找出各个包之间的依赖关系，然后根据这个关系去构建。比如说 A 包依赖了 D 包，当我们在构建 A 包之前得先去构建 D 包才成。</p> <p>以上是没有工具链时可能会出现的问题。如果我们用上 lerna 的话，内置的一些命令就可以基本帮助我们解决问题了：</p> <ul><li>lerna changed 寻找代码有变动的包，接下来我们就可以自己去进行增量构建了。</li> <li>通过 lerna 执行命令，本身就会去进行拓扑排序，所以包之间存在依赖时的构建问题也就被解决了。
总结一下构建时我们会遇到的问题：</li></ul> <h3 id="单测"><a href="#单测" class="header-anchor">#</a> 单测</h3> <p>单测的问题其实和构建遇到的问题类似。每次把所有用例都跑一遍，可能耗时比构建还长，引入增量单测很有必要。</p> <p>这个需求一般来说单测工具都会提供，比如 Jest 通过以下命令我们就能实现需求了：</p> <div class="language- extra-class"><pre class="language-text"><code>jest --coverage --changedSince=master
</code></pre></div><p>但是这种单测方式会引来一个小问题：单测覆盖率是以「测试用例覆盖的代码 / 修改过的代码」来算的，很可能会出现覆盖率不达标的问题，虽然整体的单测覆盖率可能是达标的。 常写单测的读者肯定知道有时候一部分代码就是很难写单测，出现这种问题也在所难免，但是如果我们在 CI 中配置了低于覆盖率就不能通过 CI 的话就会有点蛋疼。</p> <p>当然这个问题其实仁者见仁智者见智，往好了说也是在提高每次 commit 的代码质量。</p> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <p>部署是最重要的一环了，这里会遇到的问题也是最复杂的，当然大部分问题其实之前都解决过了，问题大致可分为：</p> <p>如何给单个 package 部署？
单个 package 部署时有依赖关系如何解决？
package 部署时版本如何自动计算？
首先来看前两个问题。</p> <p>第一个问题的解决办法其实和增量构建那边做法一样，通过命令找到修改过代码的 package 就行。但是光找到需要部署的 package 还不够，我们还需要通过拓扑排序看看这个 package 有没有被别的 package 所依赖。如果被别的 package 所依赖的话，依赖方即使代码没有变动也是需要进行部署的，这就是第二个问题的解决方案。</p> <p>第三个问题解决起来涉及的东西会有点多，笔者之前也给自动化部署系统写过一篇文章：链接 ，有兴趣的读者可以一读。</p> <h2 id="工具链带来的好处及坏处"><a href="#工具链带来的好处及坏处" class="header-anchor">#</a> 工具链带来的好处及坏处</h2> <p>从上文中读者们应该也可以发现这些 monorepo 的工具链帮助我们解决了很多问题，以至于把这些问题都隐藏了起来，导致了很多开发者可能都不了解使用 monorepo 到底会带来哪些问题。</p> <p>另外这些工具链也并不是完美的，使用它们以后其实又会带来一些别的问题。</p> <p>比如说我们用 yarn workspaces 解决了 link 以及安装依赖的问题，但是又带来了版本间的冲突以及非法访问依赖的问题，解决这些问题我们可能又得引入新的包管理器，比如 pnpm 来解决。</p> <p>总的来说，在编程世界里还真的没啥银弹，看似不错的工具，在帮助我们解决了不少问题的同时必然又会引入新的问题，选择工具无非是在看当下哪个使用起来成本更低收益更大罢了。</p> <h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <p><a href="https://juejin.cn/post/6944877410827370504#heading-5" target="_blank" rel="noopener noreferrer">现代前端工程为什么越来越离不开 Monorepo?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://segmentfault.com/a/1190000039814987" target="_blank" rel="noopener noreferrer">开源项目都在用 monorepo，但是你知道居然有那么多坑么？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.6cee7c1e.js" defer></script><script src="/assets/js/3.93150daa.js" defer></script><script src="/assets/js/1.98eba2ee.js" defer></script><script src="/assets/js/78.f4a46975.js" defer></script>
  </body>
</html>
